
@{
    ViewData["Title"] = "PrEP";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="row d-flex dashboard-row dashboard-bg-ws justify-content-around">
        <div class="col-3" style="background-color: white; height: 40vh">
            <div class="d-flex flex-column justify-content-around" style="height: 20vh">
                <div class="row d-flex justify-content-center indicator-title">PrEP_NEW</div>
                <div class="row d-flex justify-content-center indicator-value">
                    <span id="PrEP_NEW-value"></span>
                </div>
                <div class="row d-flex justify-content-center indicator-percent">
                    <span class="align-middle" id="PrEP_NEW-percent">
                        
                    </span>
                </div>
            </div>
            <div id="PrEP_NEW_chart" style="height: 20vh">

            </div>
        </div>
        <div class="col-3" style="background-color: white; height: 40vh">
            <div class="d-flex flex-column justify-content-around" style="height: 20vh">
                <div class="row d-flex justify-content-center indicator-title">PrEP_CURR</div>
                <div class="row d-flex justify-content-center indicator-value" id="PrEP_CURR-value"></div>
                <div class="row d-flex justify-content-center indicator-percent">
                    <span class="align-middle" id="PrEP_CURR-percent">
                        <svg xmlns="http://www.w3.org/2000/svg" color="green" width="35" height="35" fill="currentColor" class="bi bi-caret-up-fill" viewBox="0 0 20 20">
                            <path d="M7.247 4.86l-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z" />
                        </svg>
                        38%
                    </span>
                </div>
            </div>
            <div id="PrEP_CURR_chart" style="height: 20vh">

            </div>
        </div>
        <div class="col-3" style="background-color: white; height: 40vh">
            <div class="d-flex flex-column justify-content-around" style="height: 20vh">
                <div class="row d-flex justify-content-center indicator-title">%PrEP_3M</div>
                <div class="row d-flex justify-content-center indicator-value" id="pPrEP_3M-value"></div>
                <div class="row d-flex justify-content-center indicator-percent">
                    <span class="align-middle" id="pPrEP_3M-percent">
                        <svg xmlns="http://www.w3.org/2000/svg" color="green" width="35" height="35" fill="currentColor" class="bi bi-caret-up-fill" viewBox="0 0 20 20">
                            <path d="M7.247 4.86l-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z" />
                        </svg>
                        03%
                    </span>
                </div>
            </div>
            <div id="pPrEP_3M_chart" style="height: 20vh">

            </div>
        </div>
    </div>
    <div class="row dashboard-row">
        <div class="col-12" style="margin:15px">
            <h3>PrEP Variables</h3>
        </div>
        <div class="col-12 d-flex justify-content-around">
            <div class="col-3">
                <div class="col-12" style="background-color: whitesmoke; height: 40vh">
                    <div class="row" style="padding-left: 15px; padding-top: 15px">
                        <h4>Age Group</h4>
                    </div>
                    <div id="age-group-chart"></div>
                </div>
            </div>
            <div class="col-3">
                <div class="col-12" style="background-color: whitesmoke; height: 40vh">
                    <div class="row" style="padding-left: 15px; padding-top: 15px">
                        <h4>Gender</h4>
                    </div>
                    <div id="gender-chart"></div>
                </div>
            </div>
            <div class="col-3">
                <div class="col-12" style="background-color: whitesmoke; height: 40vh">
                    <div class="row" style="padding-left: 15px; padding-top: 15px">
                        <h4>Key Populations</h4>
                    </div>
                    <div id="key-populations-chart"></div>
                </div>
            </div>
            <div class="col-3">
                <div class="col-12" style="background-color: whitesmoke; height: 40vh">
                    <div class="row" style="padding-left: 15px; padding-top: 15px">
                        <h4>Clinics</h4>
                    </div>
                    <div id="clinics-chart"></div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>
        function createAgeGroupChart() {
            $("#age-group-chart").kendoChart({
                theme: "bootstrap",
                legend: {
                    visible: false
                },
                seriesDefaults: {
                    type: "bar"
                },
                series: [{
                    name: "Age Group",
                    data: [10, 70, 43, 25, 12, 5, 2, 4],
                    color: "#62666e",
                }],
                valueAxis: {
                    max: 75,
                    line: {
                        visible: false
                    },
                    minorGridLines: {
                        visible: true
                    },
                    labels: {
                        rotation: "auto"
                    }
                },
                categoryAxis: {
                    categories: ["15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50+"],
                    majorGridLines: {
                        visible: false
                    }
                },
            });
        }

        function createGenderChart() {
            $("#gender-chart").kendoChart({
                theme: "bootstrap",
                legend: {
                    visible: false
                },
                seriesDefaults: {
                    type: "bar"
                },
                series: [{
                    name: "Gender",
                    data: [20, 150],
                    color: "#62666e",
                }],
                valueAxis: {
                    max: 155,
                    line: {
                        visible: false
                    },
                    minorGridLines: {
                        visible: true
                    },
                    labels: {
                        rotation: "auto"
                    }
                },
                categoryAxis: {
                    categories: ["Female", "Male"],
                    majorGridLines: {
                        visible: false
                    }
                },
            });
        }

        function createKeyPopulationsChart() {
            $("#key-populations-chart").kendoChart({
                theme: "bootstrap",
                legend: {
                    visible: false
                },
                seriesDefaults: {
                    type: "bar"
                },
                series: [{
                    name: "Key Populations",
                    data: [3, 105, 0, 60, 0, 0, 0],
                    color: "#62666e",
                }],
                valueAxis: {
                    max: 115,
                    line: {
                        visible: false
                    },
                    minorGridLines: {
                        visible: true
                    },
                    labels: {
                        rotation: "auto"
                    }
                },
                categoryAxis: {
                    categories: ["FSWs", "MSM", "PWID", "SDCs", "TCMT", "TGW", "Others"],
                    majorGridLines: {
                        visible: false
                    }
                },
            });
        }

        function createClinicsChart() {
            $("#clinics-chart").kendoChart({
                theme: "bootstrap",
                legend: {
                    visible: false
                },
                seriesDefaults: {
                    type: "bar"
                },
                series: [{
                    name: "Clinic",
                    data: [55, 70, 50],
                    color: "#62666e",
                }],
                valueAxis: {
                    max: 75,
                    line: {
                        visible: false
                    },
                    minorGridLines: {
                        visible: true
                    },
                    labels: {
                        rotation: "auto"
                    }
                },
                categoryAxis: {
                    categories: ["OPC D9", "OPC D11", "Thu Duc"],
                    majorGridLines: {
                        visible: false
                    }
                },
            });
        }

        function createPrEP_NEW_chart() {
            $("#PrEP_NEW_chart").kendoChart({
                seriesDefaults: {
                    type: "area",
                    area: {
                        line: {
                            style: "smooth"
                        }
                    },
                },
                series: [{
                    data: [0.507, 1.943, 2.848, 0.284, 3.263, 4.801, 6.890, 8.238, 9, 4.552, 15.855, 25],
                    color: "#62666e"
                }],
                categoryAxis: {
                    title: {
                    },
                    majorGridLines: {
                        visible: false
                    },
                    majorTicks: {
                        visible: false
                    }
                },
                valueAxis: {
                    max: 25,
                    title: {
                    },
                    majorGridLines: {
                        visible: false
                    },
                    visible: false
                }
            });
        }

        function createPrEP_CURR_chart() {
            $("#PrEP_CURR_chart").kendoChart({
                seriesDefaults: {
                    type: "area",
                    area: {
                        line: {
                            style: "smooth"
                        }
                    },
                },
                series: [{
                    data: [0.507, 3.943, 2.848, 0.284, 7.263, 4.801, 7.890, 4.238, 9, 4.552, 15.855, 25],
                    color: "#62666e"
                }],
                categoryAxis: {
                    title: {
                    },
                    majorGridLines: {
                        visible: false
                    },
                    majorTicks: {
                        visible: false
                    }
                },
                valueAxis: {
                    max: 25,
                    title: {
                    },
                    majorGridLines: {
                        visible: false
                    },
                    visible: false
                }
            });
        }

        function createPrEP_3M_chart() {
            $("#pPrEP_3M_chart").kendoChart({
                seriesDefaults: {
                    type: "area",
                    area: {
                        line: {
                            style: "smooth"
                        }
                    },
                },
                series: [{
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 25, 25],
                    color: "#62666e"
                }],
                categoryAxis: {
                    title: {
                    },
                    majorGridLines: {
                        visible: false
                    },
                    majorTicks: {
                        visible: false
                    }
                },
                valueAxis: {
                    max: 25,
                    title: {
                    },
                    majorGridLines: {
                        visible: false
                    },
                    visible: false
                }
            });
        }

        function trendElement(trend) {
            let trendDirection = trend.direction == 1 ?
                `<svg xmlns="http://www.w3.org/2000/svg" color="${trend.criticalInfo}" width="35" height="35" fill="currentColor" class="bi bi-caret-up-fill" viewBox="0 0 20 20">
                    <path d="M7.247 4.86l-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z" />
                 </svg>`
                :
                `<svg xmlns="http://www.w3.org/2000/svg" color="${trend.criticalInfo}" width="20" height="20" fill="currentColor" class="bi bi-caret-down-fill" viewBox="0 0 20 20">
                     <path d="M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
                 </svg>`;
            return `${trendDirection}
                     ${trend.comparePercent}%
                    `;
        }

        function initPrEP_NewIndicator(indicator) {
            createPrEP_NEW_chart();
            $("#PrEP_NEW-value").html(indicator.value.value);
            $("#PrEP_NEW-value").css("color", indicator.value.criticalInfo);
            $("#PrEP_NEW-percent").html(trendElement(indicator.trend));
        }

        function initPrEP_CurrIndicator(indicator) {
            createPrEP_CURR_chart();
            $("#PrEP_CURR-value").html(indicator.value.value);
            $("#PrEP_CURR-value").css("color", indicator.value.criticalInfo);
            $("#PrEP_CURR-percent").html(trendElement(indicator.trend));
        }

        function initPrEP_3MIndicator(indicator) {
            createPrEP_3M_chart();
            $("#pPrEP_3M-value").html(indicator.value.value);
            $("#pPrEP_3M-value").css("color", indicator.value.criticalInfo);
            $("#pPrEP_3M-percent").html(trendElement(indicator.trend));
        }

        $(document).ready(() => {
            $.get('/PrEP/indicators', function (data) {
                data.forEach(indicator => {
                    switch (indicator.name) {
                        case "PrEP_NEW":
                            initPrEP_NewIndicator(indicator);
                            break;
                        case "PrEP_CURR":
                            initPrEP_CurrIndicator(indicator);
                            break;
                        case "%PrEP_3M":
                            initPrEP_3MIndicator(indicator);
                    }
                });
            });
            createAgeGroupChart();
            createGenderChart();
            createKeyPopulationsChart();
            createClinicsChart();
        });
        $(document).bind("kendo:skinChange", createPrEP_NEW_chart);
    </script>
}
